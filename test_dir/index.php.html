<?php
$ck1="";
$ck2="";
if(isset($_GET["button"]))
{
$button = $_GET["button"];
if($button=="ON")
{
$myfile = fopen("status.txt", "w+");
fwrite($myfile, "SW1ON");
fclose($myfile);
$ck1="checked";
}
else if($button=="OFF")
{
$myfile = fopen("status.txt", "w+");
fwrite($myfile, "SW1OFF");
fclose($myfile);
$ck1="";
}
}
else
{
$myfile = fopen("status.txt", "r");
if(trim(fgets($myfile))=="SW1ON")
$ck1="checked";
else
$ck1="";
fclose($myfile);
}

if(isset($_GET["button2"]))
{
$button2 = $_GET["button2"];
if($button2=="ON")
{
$myfile = fopen("status2.txt", "w+");
fwrite($myfile, "SW1ON");
fclose($myfile);
$ck2="checked";
}
else if($button2=="OFF")
{
$myfile = fopen("status2.txt", "w+");
fwrite($myfile, "SW1OFF");
fclose($myfile);
$ck2="";
}
}
else
{
$myfile = fopen("status2.txt", "r");
if(trim(fgets($myfile))=="SW1ON")
$ck2="checked";
else
$ck2="";
fclose($myfile);
}
?>


<?php 
/*if(isset($_GET["q"]))
{
if($_GET["q"]=="103")
{*/
?>

<!DOCTYPE html>
<html>
<title>Ansyst Demonstration</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon" type="image/png" href="icon.png">
<meta name="theme-color" content="#3f51b5">
<meta name="msapplication-navbutton-color" content="#3f51b5">
<meta name="apple-mobile-web-app-status-bar-style" content="#3f51b5">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif;}
body, html {
  height: 100%;
  color: #777;
  line-height: 1.8;
}

.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}
</style>
<body class="w3-indigo">

<div class="w3-center w3-indigo w3-hide-small" style="height:100px;padding-top:10px;>
<a href="/test_dir/"><img src="./logo.png" style="width:200;height:auto;" class="w3-image w3-padding w3-left"></a>
<label style="text-decoration:none;margin-left:-12%;" class="w3-xlarge">Geysers Monitoring System</label>
<a href="javascript:void(0)" class="w3-btn w3-white w3-round w3-right" style="margin:20px" onclick="document.getElementById('id01').style.display='block'" class="w3-button w3-black">Add Device</a>
</div>

<!---
<div class="w3-center w3-indigo w3-hide-medium w3-hide-large" style="height:125px;padding-top:10px;margin-bottom:50px;"">
<a href="/test_dir/"><img src="./logo.png" style="width:100%;height:auto;" class="w3-image w3-padding w3-left"></a><br>
<label style="text-decoration:none;" class="w3-xlarge">Geysers Monitoring System</label><br>
<a href="javascript:void(0)" class="w3-btn w3-indigo w3-round-large" style="margin:1px">Add Device</a>
</div>
--->

<div class="w3-top w3-center w3-indigo w3-hide-medium w3-hide-large" style="height: 173px;padding-top:14px;margin-bottom: 214px;">
<a href="/test_dir/"><img src="./logo.png" style="width:100%;height:auto;" class="w3-image w3-padding w3-left"></a><br>
<label style="text-decoration:none;" class="w3-xlarge">Geysers Monitoring System</label><br>
<a href="javascript:void(0)" class="w3-btn w3-indigo w3-round-large" style="margin:1px" onclick="document.getElementById('id01').style.display='block'" class="w3-button w3-black">Add Device</a>
</div>
<div class="w3-hide-medium w3-hide-large" style="height: 173px;"></div>

<footer class="w3-center w3-white w3-padding-32" style="margin-top:5px;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 103</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox" onclick="submitclick()" id="r103" name="r103" value="1" <?php echo $ck1; ?>>
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;" id="bt1"></button></td>
    </tr></table>
  </div>
</footer>

<footer class="w3-center w3-white w3-padding-32" style="margin-top:5px;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 105</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox" onclick="submitclick()" id="r105" name="r105" value="1" <?php echo $ck2; ?>>
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;" id="bt2"></button></td>
    </tr></table>
  </div>
</footer>

<footer class="w3-center w3-white w3-padding-32 w3-disabled" style="margin-top:5px;opacity: 1;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 106</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox">
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;"></button></td>
    </tr></table>
  </div>
</footer>

<footer class="w3-center w3-white w3-padding-32 w3-disabled" style="margin-top:5px;opacity: 1;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 108</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox">
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;"></button></td>
    </tr></table>
  </div>
</footer>

<footer class="w3-center w3-white w3-padding-32 w3-disabled" style="margin-top:5px;opacity: 1;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 110</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox">
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;"></button></td>
    </tr></table>
  </div>
</footer>

<footer class="w3-center w3-white w3-padding-32 w3-disabled" style="margin-top:5px;opacity: 1;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 111</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox">
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;"></button></td>
    </tr></table>
  </div>
</footer>

<!---
<footer class="w3-center w3-black w3-padding-32 w3-opacity w3-disabled" style="margin-top:5px;">
  <div class=" w3-section">
    <table style="width:100%"><tr>
	<td style="width:30%">Room 111</td>
	<td style="width:40%">
	OFF
	<label class="switch" style="padding-top:5px;">
	  <input type="checkbox">
	  <span class="slider round"></span>
	</label>
	ON
	</td>
	<td style="width:30%"><button class="w3-red w3-circle" style="width:30px;height:30px;"></button></td>
    </tr></table>
  </div>
</footer>
--->



  <div id="id01" class="w3-modal">
    <div class="w3-modal-content w3-animate-right w3-card-4">
      <header class="w3-container w3-indigo"> 
        <span onclick="document.getElementById('id01').style.display='none'" 
        class="w3-button w3-display-topright">&times;</span>
        <h2>Add Rooms</h2>
      </header>
      <div class="w3-container w3-padding w3-center">
        <input class="w3-input w3-margin" placeholder="Room Name">
        <input class="w3-input w3-margin" placeholder="Device ID">
        <a class="w3-btn w3-indigo w3-round-large">Save</a>
      </div>
      <footer class="w3-container w3-indigo">
        <p>Ansyst Demonstration</p>
      </footer>
    </div>
  </div>


<script>
function submitclick()
{
	var link="";
	if(document.getElementById("r103").checked)
	link = "?button=ON&";
	else
	link = "?button=OFF&";
	if(document.getElementById("r105").checked)
	link+= "button2=ON";
	else
	link+= "button2=OFF";
	window.location.assign(link);
}
OnStart();
function OnStart()
{
  var x = Math.floor((Math.random() * 10) + 1);
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {
		if(this.responseText.slice(0,1)=="1")
		document.getElementById("bt1").className = "w3-green w3-circle";
		else
		document.getElementById("bt1").className = "w3-red w3-circle";
	}
  };
  xhttp.open("GET", "astatus.txt?q="+x, true);
  xhttp.send();
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {
		if(this.responseText.slice(0,1)=="1")
		document.getElementById("bt2").className = "w3-green w3-circle";
		else
		document.getElementById("bt2").className = "w3-red w3-circle";
	}
  };
  xhttp.open("GET", "astatus2.txt?q="+x, true);
  xhttp.send();
  setTimeout(OnStart,2000);
}
</script>

</body>
</html>

<?php 
//}
?>